<body>
	<div id="UseMsg">
		<input type="hidden" id="memberId" value="@ViewBag.MemberId">
		<br>
		留言
		<br>
		<input type="text" v-model="messageBoard.messageText">
		<br>
		<button type="button" @@click="InsertMsgApi">送出</button>
	</div>
</body>

<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
	const app = Vue.createApp({
		data() {
			return {
				messageBoard: {
					memberId: "",
					messageText: ""
				}
			}
		},

		mounted() {
			let self = this;

			self.messageBoard.memberId = document.getElementById('memberId').value;
		},

		methods: {
			InsertMsgApi() {
				let self = this;

				var msgRule = /^[0-9a-zA-Z\u4e00-\u9fa5]+$/;

				if (!msgRule.test(self.messageBoard.messageText)) {
					return alert("留言欄位只允許中文、英文、數字");
				}

				fetch("/Lion/UseMsgPost", {
					method: "POST",
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify(self.messageBoard)
				})
					.then(r => r.json())
					.then(d => {
						if (d == true) {
							console.log("Success", d);
							alert("新增成功");

							window.location.href = "/Lion/MsgList";
						}
						else {
							console.log("Fail", d);
							alert("新增失敗");
						}
					}).catch(error => console.error('Error:', error));;
			},
		},
	}).mount("#UseMsg");
</script>